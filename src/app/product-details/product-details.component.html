<div class="container my-4 product-details" *ngIf="product">
  <nav class="breadcrumb mb-3">
    <a routerLink="/" class="text-decoration-none">Home</a>
    <span class="mx-2">/</span>
    <span>Product Details</span>
  </nav>

  <div class="container">
    <div class="row gy-4">
      <!-- Images column -->
      <div class="col-lg-6 col-12">
        <div class="d-flex flex-column align-items-center">
          <div class="viewer-frame mb-3 position-relative">
            <div class="image-controls-top position-absolute top-0 start-50 translate-middle-x mt-2 d-flex gap-2">
              <button class="btn btn-sm btn-outline-secondary me-1" (click)="rotate90()">Rotate 90°</button>
              <button class="btn btn-sm btn-outline-secondary me-1" (click)="toggleAutoRotate()">{{autoRotate ? 'Stop' : 'Auto Rotate'}}</button>
              <button class="btn btn-sm btn-outline-secondary me-1" (click)="resetRotation()">Reset</button>
            </div>
            <div class="img-wrap" [class.spinning]="autoRotate"
                 (mouseenter)="showZoom($event)" (mousemove)="updateZoom($event)" (mouseleave)="hideZoom()">
              <img class="viewer-image img-fluid" [src]="mainImage" [style.transform]="'rotate(' + rotateAngle + 'deg)'" alt="{{product.name}}">
            </div>
            <!-- Zoom panel visible on md+ screens only -->
            <div *ngIf="zoomVisible" class="zoom-panel d-none d-md-block" [ngStyle]="zoomStyle"></div>
          </div>

          <div class="thumbs d-flex gap-2 flex-row flex-wrap justify-content-start">
            <img *ngFor="let t of thumbnails" class="thumbnail img-thumbnail" [src]="t" (click)="setMainImage(t)" [class.active]="t===mainImage" alt="thumb">
          </div>
        </div>
      </div>

      <!-- Meta / options column -->
      <div class="col-lg-6 col-12">
        <h6 class="text-uppercase text-muted small">{{product.category || 'Product'}}</h6>
        <h1 class="h4 mb-2">{{product.name}}</h1>

        <div class="d-flex align-items-center mb-2">
          <div class="me-3">
            <ng-container *ngFor="let s of [1,2,3,4,5]">
              <button class="btn p-0 star-btn" [class.filled]="s<=rating" (click)="setRating(s)">★</button>
            </ng-container>
          </div>
          <div class="text-muted">({{rating}}/5)</div>
        </div>

        <div class="d-flex align-items-baseline gap-3 mb-3">
          <div class="fs-4 fw-bold">{{product.dealPrice}}</div>
          <div class="text-muted text-decoration-line-through">{{product.mrp}}</div>
        </div>

        <p class="text-secondary">{{product.snippet}}</p>

        <div class="mb-3 text-success">In Stock</div>

        <!-- Configuration: moved below quantity -->

        <div class="mb-3">
          <label class="form-label">Quantity</label>
          <div class="input-group" style="max-width:140px">
            <button class="btn btn-outline-secondary" (click)="decrement()" [disabled]="quantity <= 1">-</button>
            <input class="form-control text-center" type="text" [value]="quantity" readonly>
            <button class="btn btn-outline-secondary" (click)="increment()">+</button>
          </div>
        </div>

        

        

        <!-- rotation controls moved to top of image -->
         <div class="mb-3 d-flex gap-2">
          <button class="btn btn-primary" (click)="onAddToCart()">Add to Cart</button>
          <button class="btn btn-outline-primary" (click)="onBuyNow()">Buy Now</button>
        </div>

      </div>
    </div>
  </div>

    <div class="tabs">
      <ul class="tab-list">
        <li [class.active]="selectedTab==='description'" (click)="setTab('description')">Description</li>
        <li [class.active]="selectedTab==='specs'" (click)="setTab('specs')">Specifications</li>
        <li [class.active]="selectedTab==='reviews'" (click)="setTab('reviews')">Reviews</li>
      </ul>

      <div class="tab-content">
        <div *ngIf="selectedTab==='description'">
          <h3>Product Overview</h3>
          <p>{{product.description || product.snippet}}</p>

          <h4>Key Features</h4>
          <ul>
            <li>High quality audio</li>
            <li>Comfort-fit design</li>
            <li>Long battery life</li>
          </ul>
        </div>

        <div *ngIf="selectedTab==='specs'">
          <h3>Specifications</h3>
          <table class="specs">
            <tr><th>OS</th><td>{{product.android?.os || 'Android'}}</td></tr>
            <tr><th>Screen</th><td>{{product.display?.screenSize || '—'}}</td></tr>
            <tr><th>Camera</th><td>{{product.camera?.primary || '—'}}</td></tr>
            <tr><th>Battery</th><td>{{product.battery?.type || '—'}}</td></tr>
            <tr><th>Storage</th><td>{{product.storage?.flash || '—'}}</td></tr>
          </table>
        </div>

        <div *ngIf="selectedTab==='reviews'">
          <h3>Reviews</h3>
          <div class="review-summary">Average rating: <strong>{{rating}}/5</strong></div>
          <div class="review-list">
            <article class="review">
              <h4>Great sound</h4>
              <div class="meta">by Alice — 5/5</div>
              <p>Really enjoyed the clarity and bass from these headphones.</p>
            </article>
            <article class="review">
              <h4>Good value</h4>
              <div class="meta">by Bob — 4/5</div>
              <p>Comfortable and long battery life. Recommended.</p>
            </article>
          </div>
        </div>
      </div>
    </div>
</div>

<div *ngIf="!product" class="not-found">
  <p>Product not found.</p>
  <a routerLink="/">Back to store</a>
</div>
